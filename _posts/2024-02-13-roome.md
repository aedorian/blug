---
layout: post
date: 2024-02-13
---

[..](../index.html)

- [Simplified algorithm](#sim)
- [Generations](#res)
- [Tweaking parameters](#twe)

# Room generation using edge extrusion

I was looking into generating apartment-like level layouts for a game prototype. Working with Python is easier to test the algorithm, hence this first implementation.

I came up with the algorithm, but there really is a chance it already exists somewhere else.

## <a name="sim"></a>Simplified algorithm

This is a very pseudo-code version of the algorithm I used. ``extrude(rectangle)`` is a function that choses a random edge from ``rectangle``, and extrudes it in three directions: front and two sides.

``extrude(rectangle)`` can be called multiple times to generate multiple openings, hence the invalid edges list to prevent from extruding the same edge multiple times.

```
extrude (rectangle):
    edge = random edge from rectangle that is not an invalid edge
    add the edge to the rectangle's invalid edges
    
    make an opening in the chosen edge
    
    extrude edge in front
    if extruded edge hit a wall:
        add the edge to the rectangle's invalid edges
        
    if edge could extrude enough in front:
        extrude edge on the sides
        if extruded edges hit a wall:
            add the edge to the rectangle's invalid edges
            
        create new rectangle using the extruded edges
        extrude (new rectangle)
        
base rectangle = rectangle in the middle of the image
extrude (base rectangle)
```

Here is an example on a rectangle being extruded (the base rectangle is always the bottom one, and is not the same every time):

<figure style="display: inline-block">
<img src="../assets/img/roome/r1.png" height=150px>
<figcaption>edge in red, opening in green</figcaption>
</figure>
<figure style="display: inline-block">
<img src="../assets/img/roome/r2.png" height=150px>
<figcaption>edge extruded in front</figcaption>
</figure>
<figure style="display: inline-block">
<img src="../assets/img/roome/r3.png" height=150px>
<figcaption>extruded edge extruded on the sides</figcaption>
</figure>

<div class="sideside" markdown="1">
And here is an example of a rectangle being extruded multiple times (on the left, top and bottom). For the first generations I only made it so a single edge could be extruded.
{: .tleft }
<img src="../assets/img/roome/r4.png" height=200px>
{: .imright }
</div>

After fixing errors caused by extruded edges not stopping soon enough

<div class="sideside" markdown="1">
test of things that are side by side
{: .tleft }
<img src="../assets/img/roome/r1.png" height=150px>
{: .imright }
</div>

(...) All GIFs were generated using ``FFMPEG``, I used the same process which is detailed [here.](./_posts/2024-01-19-dungen.html)

## <a name="res"></a>Generations

## <a name="twe"></a>Tweaking parameters